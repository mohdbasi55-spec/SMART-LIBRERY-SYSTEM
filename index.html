<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ SMART LIBRARY PJ Manager - FIREBASE REALTIME</title>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            background: linear-gradient(135deg, #0f0f23 0%, #2a1a3d 50%, #1a0f2e 100%); 
            color: #e2e8f0; 
            min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        
        /* Login Form */
        .login { 
            max-width: 420px; margin: 100px auto; padding: 40px; 
            background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); 
            border-radius: 20px; box-shadow: 0 25px 50px rgba(0,0,0,0.3); 
            border: 1px solid rgba(255,255,255,0.2);
        }
        .login h2 { text-align: center; margin-bottom: 30px; color: #fff; font-size: 28px; }
        input { width: 100%; padding: 15px; margin: 12px 0; border: none; border-radius: 12px; 
                background: rgba(255,255,255,0.9); font-size: 16px; transition: all 0.3s; }
        input:focus { outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,0.3); transform: scale(1.02); }
        button { width: 100%; padding: 15px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
                color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; 
                cursor: pointer; transition: all 0.3s; margin: 10px 0; }
        button:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(59,130,246,0.4); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Dashboard */
        .dashboard { display: none; background: rgba(255,255,255,0.05); 
                    backdrop-filter: blur(20px); border-radius: 20px; 
                    border: 1px solid rgba(255,255,255,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #1e3a8a, #1e40af); padding: 25px 30px; 
                 display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 28px; display: flex; align-items: center; gap: 12px; }
        
        /* Firebase Status */
        .firebase-status { padding: 15px 25px; background: rgba(16,185,129,0.2); 
                          border-radius: 12px; margin: 20px; text-align: center; 
                          border-left: 5px solid #10b981; }
        
        /* Kanban Board */
        .kanban { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
                 gap: 25px; padding: 40px; min-height: 600px; }
        .column { background: rgba(255,255,255,0.08); border-radius: 16px; padding: 25px; 
                 backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.15); 
                 transition: all 0.3s; }
        .column:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .column h3 { margin: 0 0 25px 0; font-size: 20px; display: flex; align-items: center; gap: 10px; 
                    color: #60a5fa; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Tasks */
        .task { background: rgba(255,255,255,0.15); margin: 15px 0; padding: 20px; 
               border-radius: 12px; cursor: grab; transition: all 0.3s; 
               border-left: 5px solid #10b981; position: relative; overflow: hidden; }
        .task:active { cursor: grabbing; }
        .task:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .task.dragging { opacity: 0.7; transform: rotate(3deg) scale(1.02); z-index: 1000; }
        .task.high { border-left-color: #ef4444; }
        .task.urgent { border-left-color: #f59e0b; animation: pulse 2s infinite; }
        
        /* Progress Bar */
        .progress-container { background: rgba(0,0,0,0.3); height: 8px; border-radius: 4px; 
                            margin: 12px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #10b981, #059669); 
                       transition: width 0.4s ease; border-radius: 4px; position: relative; }
        .progress-text { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); 
                        font-size: 12px; font-weight: 600; color: #fff; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
                     gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(29,78,216,0.2)); 
                    padding: 25px; border-radius: 16px; text-align: center; 
                    border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); }
        .stat-card h3 { font-size: 32px; margin: 0 0 8px 0; color: #fff; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.7); z-index: 2000; backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                        background: rgba(255,255,255,0.15); padding: 40px; border-radius: 20px; 
                        max-width: 600px; width: 90%; backdrop-filter: blur(20px); 
                        border: 1px solid rgba(255,255,255,0.3); }
        
        /* Notifications */
        .notification { position: fixed; top: 30px; right: 30px; padding: 20px 25px; 
                       background: linear-gradient(135deg, #10b981, #059669); color: white; 
                       border-radius: 12px; box-shadow: 0 15px 35px rgba(16,185,129,0.4); 
                       transform: translateX(400px); transition: transform 0.4s ease; z-index: 3000; 
                       font-weight: 500; }
        .notification.show { transform: translateX(0); }
        .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); 
                             box-shadow: 0 15px 35px rgba(239,68,68,0.4); }
        
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(245,158,11,0.7); } 50% { box-shadow: 0 0 0 10px rgba(245,158,11,0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body>
    <div class="container">
        <!-- LOGIN -->
        <div id="login" class="login">
            <h2>üöÄ SMART LIBRARY PJ Manager</h2>
            <p style="text-align: center; color: #cbd5e1; margin-bottom: 30px;">
                üî• LIVE FIREBASE REALTIME DATABASE<br>
                <small style="color: #10b981;">smart-librery-system.firebaseapp.com</small>
            </p>
            <input type="text" id="username" placeholder="üë§ Username">
            <input type="password" id="password" placeholder="üîí Password">
            <button id="loginBtn" onclick="login()">üîê Connect to Firebase</button>
            <div id="firebaseStatus" style="font-size: 12px; text-align: center; margin-top: 10px;"></div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="adminDash" class="dashboard">
            <div class="header">
                <h1>üë®‚Äçüíº Admin Control Panel</h1>
                <div>
                    <span id="adminStats" style="margin-right: 20px; font-size: 18px;"></span>
                    <span id="onlineStatus" style="background: #10b981; padding: 4px 12px; border-radius: 20px; font-size: 12px;">üü¢ LIVE</span>
                    <button onclick="showReports()">üìä Reports</button>
                    <button onclick="showAddTaskModal()">‚ûï New Task</button>
                    <button onclick="logout()">üö™ Logout</button>
                </div>
            </div>
            
            <div class="firebase-status">
                <strong>üî• FIREBASE REALTIME STATUS:</strong> 
                <span id="firebaseConnected">Connected</span> | 
                <span id="liveTasks">0</span> Tasks | 
                <span id="liveUsers">0</span> Users
            </div>
            
            <div class="stats-grid">
                <div class="stat-card"><h3 id="totalTasks">0</h3><p>Total Tasks</p></div>
                <div class="stat-card"><h3 id="completedTasks">0</h3><p>Completed</p></div>
                <div class="stat-card"><h3 id="overdueTasks">0</h3><p>Overdue</p></div>
                <div class="stat-card"><h3 id="highPriority">0</h3><p>High Priority</p></div>
            </div>
            <div class="kanban" id="kanbanBoard">
                <div class="column" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h3>üìö To Do</h3>
                </div>
                <div class="column" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h3>‚ö° In Progress</h3>
                </div>
                <div class="column" id="review" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h3>üîç Review</h3>
                </div>
                <div class="column" id="done" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h3>‚úÖ Done</h3>
                </div>
            </div>
        </div>

        <!-- STUDENT DASHBOARD -->
        <div id="studentDash" class="dashboard">
            <div class="header">
                <h1>üë©‚Äçüéì Student Dashboard</h1>
                <div>
                    <span id="studentStats"></span>
                    <span id="studentOnline" style="background: #10b981; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-left: 10px;">üü¢ LIVE</span>
                    <button onclick="logout()">üö™ Logout</button>
                </div>
            </div>
            <div class="firebase-status">
                <strong>üë§ My Live Tasks:</strong> <span id="myTaskCount">0</span> active projects
            </div>
            <div class="kanban" id="studentKanban"></div>
        </div>

        <!-- ADD TASK MODAL -->
        <div id="addTaskModal" class="modal">
            <div class="modal-content">
                <h2>‚ûï Create Library Task</h2>
                <div class="form-grid">
                    <input type="text" id="taskName" placeholder="üìñ Project Title">
                    <input type="text" id="assignee" placeholder="üë§ Student Username">
                    <select id="priority" style="grid-column: 1 / -1;">
                        <option value="normal">Priority: Normal üìö</option>
                        <option value="high">Priority: High üö®</option>
                        <option value="urgent">Priority: URGENT ‚ö°</option>
                    </select>
                    <input type="date" id="deadline">
                    <textarea id="description" placeholder="üìù Task Description..." style="grid-column: 1 / -1;"></textarea>
                </div>
                <button onclick="saveNewTask()">‚úÖ Save to Firebase</button>
                <button onclick="closeAddTaskModal()" style="background: #6b7280;">‚ùå Cancel</button>
            </div>
        </div>

        <!-- REPORTS MODAL -->
        <div id="reportsModal" class="modal">
            <div class="modal-content">
                <h2>üìä Firebase Analytics</h2>
                <div id="reportsContent"></div>
                <button onclick="closeReports()" style="float: right; background: #6b7280;">Close</button>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="notification" class="notification"></div>

    <script>
        // üî• YOUR FIREBASE CONFIG - LIVE SMART LIBRARY SYSTEM
        const firebaseConfig = {
            apiKey: "AIzaSyA7eoeeSQjQ4WkW7yII-EuPzzjYyt7njZw",
            authDomain: "smart-librery-system.firebaseapp.com",
            databaseURL: "https://smart-librery-system-default-rtdb.firebaseio.com",
            projectId: "smart-librery-system",
            storageBucket: "smart-librery-system.firebasestorage.app",
            messagingSenderId: "743750444687",
            appId: "1:743750444687:web:9f385eadfad58d762bb2fa",
            measurementId: "G-NP33E8R4J8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Global state
        let currentUser = '';
        let tasks = [];
        let usersOnline = {};

        // üî• REAL-TIME DATABASE LISTENERS
        const tasksRef = db.ref('tasks');
        tasksRef.on('value', (snapshot) => {
            const data = snapshot.val();
            tasks = data ? Object.values(data) : [];
            if (currentUser) {
                if (currentUser === 'admin') {
                    renderKanban();
                    updateAdminStats();
                } else {
                    renderStudentDashboard();
                }
            }
        });

        const onlineRef = db.ref('.info/connected');
        onlineRef.on('value', (snap) => {
            if (snap.val() === true) {
                updateFirebaseStatus('üü¢ LIVE - Realtime Sync');
            } else {
                updateFirebaseStatus('üî¥ Offline');
            }
        });

        // Auth simulation with Firebase storage
        const authRef = db.ref('users');
        
        // UI Functions
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            document.getElementById('loginBtn').disabled = true;
            document.getElementById('loginBtn').textContent = 'üîÑ Connecting...';
            
            try {
                // Check user in Firebase
                const snapshot = await authRef.child(username).once('value');
                const userData = snapshot.val();
                
                if (userData && userData.password === password) {
                    currentUser = username;
                    
                    // Set user online status
                    db.ref('onlineUsers/' + username).set({
                        name: userData.name || username,
                        role: userData.role || 'student',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    document.getElementById('login').style.display = 'none';
                    showDashboard();
                    showNotification(`üéâ Welcome ${userData.name || username} to LIVE system!`);
                } else {
                    showNotification('‚ùå Invalid credentials!', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Firebase connection failed!', 'error');
                console.error('Firebase Error:', error);
            } finally {
                document.getElementById('loginBtn').disabled = false;
                document.getElementById('loginBtn').textContent = 'üîê Connect to Firebase';
            }
        }

        function showDashboard() {
            if (currentUser === 'admin') {
                document.getElementById('adminDash').style.display = 'block';
                renderKanban();
                updateAdminStats();
            } else {
                document.getElementById('studentDash').style.display = 'block';
                renderStudentDashboard();
            }
        }

        function renderKanban() {
            const columns = ['todo', 'progress', 'review', 'done'];
            columns.forEach(col => {
                document.getElementById(col).innerHTML = `<h3>${
                    col === 'todo' ? 'üìö To Do' : 
                    col === 'progress' ? '‚ö° In Progress' : 
                    col === 'review' ? 'üîç Review' : '‚úÖ Done'
                }</h3>`;
            });

            tasks.forEach(task => {
                const taskElement = createTaskElement(task);
                const column = document.getElementById(task.status || 'todo');
                if (column) column.appendChild(taskElement);
            });
        }

        function createTaskElement(task) {
            const div = document.createElement('div');
            div.className = `task ${task.priority || 'normal'} ${isOverdue(task) ? 'urgent' : ''}`;
            div.draggable = true;
            div.dataset.id = task.id;
            div.ondragstart = drag;
            
            const daysLeft = getDaysLeft(task.deadline);
            const overdue = isOverdue(task);
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <strong style="flex: 1; margin-right: 10px;">${task.name}</strong>
                    <span style="font-size: 12px; padding: 4px 8px; background: rgba(0,0,0,0.3); border-radius: 20px;">
                        ${task.priority?.toUpperCase() || 'NORMAL'}
                    </span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" style="width: ${task.progress || 0}%">
                        <span class="progress-text">${task.progress || 0}%</span>
                    </div>
                </div>
                <div style="font-size: 13px; color: #cbd5e1; margin: 8px 0;">
                    üë§ ${task.assignee} | ${overdue ? '‚è∞ OVERDUE!' : daysLeft + ' days left'}
                </div>
                ${task.description ? `<p style="margin: 12px 0 8px 0; font-size: 14px; line-height: 1.5;">${task.description}</p>` : ''}
                <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                    ${currentUser === 'admin' ? 
                        `<button onclick="deleteTask('${task.id}')" style="padding: 6px 12px; font-size: 12px; background: #ef4444;">üóëÔ∏è Delete</button>` : ''
                    }
                    ${(currentUser === task.assignee || currentUser === 'admin') ? 
                        `<button onclick="updateProgress('${task.id}')" style="padding: 6px 12px; font-size: 12px; background: #10b981;">üìà +25%</button>` : ''
                    }
                </div>
            `;
            return div;
        }

        // Drag & Drop
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { 
            ev.dataTransfer.setData("text", ev.target.dataset.id); 
            ev.target.classList.add('dragging');
        }
        
        async function drop(ev) {
            ev.preventDefault();
            const taskId = ev.dataTransfer.getData("text");
            const newStatus = ev.currentTarget.id;
            
            const taskRef = db.ref('tasks/' + taskId);
            await taskRef.update({ 
                status: newStatus,
                updated: firebase.database.ServerValue.TIMESTAMP
            });
            
            showNotification(`‚úÖ Task moved to ${newStatus.toUpperCase()}`);
        }

        async function updateProgress(taskId) {
            const taskRef = db.ref('tasks/' + taskId);
            const snapshot = await taskRef.once('value');
            const task = snapshot.val();
            const newProgress = Math.min((task.progress || 0) + 25, 100);
            
            await taskRef.update({ 
                progress: newProgress,
                updated: firebase.database.ServerValue.TIMESTAMP
            });
            showNotification(`üìà Progress: ${newProgress}%`);
        }

        async function deleteTask(taskId) {
            if (confirm('Delete from LIVE Firebase?')) {
                await db.ref('tasks/' + taskId).remove();
                showNotification('üóëÔ∏è Task deleted from Firebase');
            }
        }

        async function saveNewTask() {
            const taskData = {
                name: document.getElementById('taskName').value,
                assignee: document.getElementById('assignee').value,
                priority: document.getElementById('priority').value,
                deadline: document.getElementById('deadline').value,
                description: document.getElementById('description').value,
                progress: 0,
                status: 'todo',
                created: firebase.database.ServerValue.TIMESTAMP,
                updated: firebase.database.ServerValue.TIMESTAMP
            };
            
            if (taskData.name && taskData.assignee) {
                const newTaskRef = db.ref('tasks').push();
                await newTaskRef.set(taskData);
                closeAddTaskModal();
                showNotification('‚úÖ Task saved to LIVE Firebase!');
            }
        }

        async function updateAdminStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.status === 'done').length;
            const overdue = tasks.filter(t => isOverdue(t)).length;
            const highPriority = tasks.filter(t => t.priority === 'high' || t.priority === 'urgent').length;
            
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('overdueTasks').textContent = overdue;
            document.getElementById('highPriority').textContent = highPriority;
            document.getElementById('adminStats').textContent = `${total} live | ${completed} done | ${overdue} overdue`;
            document.getElementById('liveTasks').textContent = total;
        }

        async function renderStudentDashboard() {
            const myTasks = tasks.filter(t => t.assignee === currentUser);
            const container = document.getElementById('studentKanban');
            container.innerHTML = '<h2 style="grid-column: 1/-1; text-align: center; color: #60a5fa;">üìö My Library Tasks</h2>';
            
            document.getElementById('myTaskCount').textContent = myTasks.length;
            document.getElementById('studentStats').textContent = `${myTasks.length} projects`;
            
            myTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                taskElement.draggable = true;
                taskElement.dataset.id = task.id;
                taskElement.ondragstart = drag;
                container.appendChild(taskElement);
            });
        }

        function updateFirebaseStatus(status) {
            document.getElementById('firebaseStatus').textContent = status;
            if (status.includes('LIVE')) {
                document.getElementById('firebaseStatus').style.color = '#10b981';
            } else {
                document.getElementById('firebaseStatus').style.color = '#ef4444';
            }
        }

        // Modal functions
        function showAddTaskModal() {
            if (currentUser !== 'admin') {
                showNotification('‚ùå Admin only!', 'error');
                return;
            }
            document.getElementById('addTaskModal').style.display = 'block';
            document.getElementById('deadline').valueAsDate = new Date(Date.now() + 7*24*60*60*1000);
        }
        function closeAddTaskModal() { document.getElementById('addTaskModal').style.display = 'none'; }

        // Utility functions
        function getDaysLeft(deadline) {
            if (!deadline) return 'No deadline';
            return Math.ceil((new Date(deadline) - Date.now()) / (1000 * 60 * 60 * 24));
        }

        function isOverdue(task) {
            return task.deadline && new Date(task.deadline) < new Date();
        }

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification show ${type}`;
            setTimeout(() => notif.classList.remove('show'), 5000);
        }

        function logout() {
            if (currentUser) {
                db.ref('onlineUsers/' + currentUser).remove();
            }
            currentUser = '';
            document.querySelectorAll('.dashboard, .modal').forEach(el => el.style.display = 'none');
            document.getElementById('login').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Auto-seed demo data on first load (admin only)
        window.addEventListener('load', () => {
            updateFirebaseStatus('üî• Connecting to Firebase...');
        });

        // Keyboard support
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && document.getElementById('login').style.display !== 'none') {
                login();
            }
        });
    </script>
</body>
</html>
