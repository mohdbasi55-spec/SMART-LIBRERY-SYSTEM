<!DOCTYPE html>
<html>
<head>
<title>Smart Digital Library</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:#f4f6f8;
  transition:0.4s;
}
.dark{
  background:#111;
  color:white;
}
header{
  background:linear-gradient(to right,#2c3e50,#2980b9);
  color:white;
  padding:15px;
  text-align:center;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  background:#27ae60;
  color:white;
}
#scanner,#dashboard{
  padding:20px;
}
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:10px;
}
.stat{
  background:white;
  padding:10px;
  border-radius:10px;
  text-align:center;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.dark .stat{background:#222;}
.books{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:15px;
  margin-top:15px;
}
.book{
  background:#3498db;
  color:white;
  padding:15px;
  border-radius:15px;
  text-align:center;
  cursor:pointer;
  transition:0.3s;
}
.book:hover{
  transform:scale(1.05);
  background:#1abc9c;
}
#viewer{
  margin-top:15px;
}
iframe,video,audio{
  width:100%;
  height:350px;
  border-radius:10px;
}
.search{
  margin:10px 0;
  width:100%;
  padding:10px;
  border-radius:20px;
  border:1px solid #ccc;
}
</style>
</head>

<body>
<header>
<h2>SMART DIGITAL LIBRARY</h2>
<button onclick="toggleMode()">Dark / Light</button>
</header>

<div id="scanner">
<h3>Scan QR to Login</h3>
<div id="reader" style="width:300px;margin:auto;"></div>
</div>

<div id="dashboard" style="display:none;">
<div class="stats">
<div class="stat">Total Books: 50</div>
<div class="stat">Login Count: <span id="loginCount">0</span></div>
<div class="stat">Logout Count: <span id="logoutCount">0</span></div>
<div class="stat">Most Read: <span id="mostRead">Book 1</span></div>
</div>

<input type="text" class="search" placeholder="Search book..." onkeyup="searchBook(this.value)">

<div class="books" id="bookshelf"></div>

<h3>Reader</h3>
<div id="viewer"></div>

<br>
<button onclick="logout()">Scan QR to Logout</button>
</div>

<script>
let loginCount=0;
let logoutCount=0;
let readCount={};

const books=[];
for(let i=1;i<=50;i++){
  books.push({name:"Book "+i,type:i%3});
  readCount["Book "+i]=0;
}

function loadBooks(list=books){
  let shelf=document.getElementById("bookshelf");
  shelf.innerHTML="";
  list.forEach(b=>{
    let d=document.createElement("div");
    d.className="book";
    d.innerText=b.name;
    d.onclick=()=>openBook(b);
    shelf.appendChild(d);
  });
}

function openBook(book){
  let v=document.getElementById("viewer");
  readCount[book.name]++;
  updateMostRead();
  if(book.type==0){
    v.innerHTML="<iframe src='https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'></iframe>";
  }
  else if(book.type==1){
    v.innerHTML="<video controls src='https://www.w3schools.com/html/mov_bbb.mp4'></video>";
  }
  else{
    v.innerHTML="<audio controls src='https://www.w3schools.com/html/horse.mp3'></audio>";
  }
}

function updateMostRead(){
  let max=0,book="Book 1";
  for(let b in readCount){
    if(readCount[b]>max){
      max=readCount[b];
      book=b;
    }
  }
  document.getElementById("mostRead").innerText=book;
}

function searchBook(val){
  let f=books.filter(b=>b.name.toLowerCase().includes(val.toLowerCase()));
  loadBooks(f);
}

function toggleMode(){
  document.body.classList.toggle("dark");
}

function logout(){
  logoutCount++;
  document.getElementById("logoutCount").innerText=logoutCount;
  location.reload();
}

function onScanSuccess(){
  document.getElementById("scanner").style.display="none";
  document.getElementById("dashboard").style.display="block";
  loginCount++;
  document.getElementById("loginCount").innerText=loginCount;
  loadBooks();
  html5QrCode.stop();
}

const html5QrCode=new Html5Qrcode("reader");
html5QrCode.start(
{facingMode:"environment"},
{fps:10,qrbox:250},
onScanSuccess
);
</script>
</body>
</html>
