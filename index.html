<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced PJ Manager</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .login { max-width: 400px; margin: 100px auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #e1e5e9; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        button { padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        button:hover { background: #059669; transform: translateY(-1px); }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        .dashboard { display: none; background: white; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: #1f2937; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .kanban { display: flex; gap: 20px; padding: 30px; min-height: 500px; }
        .column { flex: 1; background: #f8fafc; border-radius: 12px; padding: 20px; max-height: 600px; overflow-y: auto; }
        .column h3 { margin: 0 0 20px 0; color: #1e40af; font-size: 18px; }
        .task { background: white; margin: 12px 0; padding: 16px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); cursor: grab; transition: all 0.3s; border-left: 4px solid #10b981; }
        .task:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .task.dragging { opacity: 0.5; transform: rotate(5deg); }
        .task.high { border-left-color: #ef4444; }
        .task.normal { border-left-color: #10b981; }
        .task.progress-bar { background: #e5e7eb; height: 6px; border-radius: 3px; margin: 8px 0; overflow: hidden; }
        .task.progress-fill { height: 100%; background: linear-gradient(90deg, #10b981, #059669); transition: width 0.3s; border-radius: 3px; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: #10b981; color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateX(400px); transition: transform 0.3s; z-index: 1000; }
        .notification.show { transform: translateX(0); }
        .reports { padding: 30px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; text-align: center; }
        .file-upload { position: relative; display: inline-block; cursor: pointer; }
        .file-upload input { position: absolute; opacity: 0; width: 100%; height: 100%; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; }
        @media (max-width: 768px) { .kanban { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <div id="login" class="login">
            <h2>üöÄ Advanced PJ Manager</h2>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()">Login</button>
        </div>

        <div id="adminDash" class="dashboard">
            <div class="header">
                <h1>üë®‚Äçüíº Admin Dashboard</h1>
                <div>
                    <span id="adminStats"></span>
                    <button onclick="showReports()">üìä Reports</button>
                    <button onclick="logout()">Logout</button>
                </div>
            </div>
            <div class="kanban">
                <div class="column" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)"><h3>üìã To Do</h3></div>
                <div class="column" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)"><h3>‚ö° In Progress</h3></div>
                <div class="column" id="review" ondrop="drop(event)" ondragover="allowDrop(event)"><h3>üîç Review</h3></div>
                <div class="column" id="done" ondrop="drop(event)" ondragover="allowDrop(event)"><h3>‚úÖ Done</h3></div>
            </div>
            <div style="padding: 30px; background: #f8fafc;">
                <h3>Add New Task</h3>
                <input type="text" id="taskName" placeholder="Task Name">
                <input type="text" id="assignee" placeholder="Student (student1, student2)">
                <select id="priority">
                    <option value="normal">Normal</option>
                    <option value="high">High Priority</option>
                </select>
                <input type="date" id="deadline">
                <textarea id="description" placeholder="Description" rows="3"></textarea>
                <div class="file-upload">
                    <input type="file" id="fileUpload" multiple>
                    <button>üìé Attach Files</button>
                </div>
                <button onclick="addTask()">‚ûï Create Task</button>
            </div>
        </div>

        <div id="studentDash" class="dashboard">
            <div class="header">
                <h1>üë©‚Äçüéì Student Dashboard</h1>
                <button onclick="logout()">Logout</button>
            </div>
            <div style="padding: 30px;">
                <h2>My Tasks</h2>
                <div id="studentTasks" class="kanban"></div>
            </div>
        </div>

        <div id="reportsModal" class="modal">
            <div class="modal-content">
                <h2>üìà Project Reports</h2>
                <div id="reportsContent" class="reports"></div>
                <button onclick="closeReports()" style="float: right;">Close</button>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        const users = { 
            admin: 'admin123', 
            student1: 'student123', 
            student2: 'student223' 
        };
        let currentUser = '';
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];

        // Initialize sample data
        if (tasks.length === 0) {
            tasks = [
                { id: 1, name: 'Design Database Schema', assignee: 'student1', status: 'todo', priority: 'high', deadline: '2026-03-05', progress: 0, files: [], created: Date.now() },
                { id: 2, name: 'Frontend UI', assignee: 'student2', status: 'progress', priority: 'normal', deadline: '2026-03-10', progress: 60, files: [], created: Date.now() }
            ];
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function login() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            if (users[user] && users[user] === pass) {
                currentUser = user;
                document.getElementById('login').style.display = 'none';
                showDashboard();
                checkNotifications();
            } else {
                showNotification('‚ùå Invalid credentials!', 'error');
            }
        }

        function showDashboard() {
            if (currentUser === 'admin') {
                document.getElementById('adminDash').style.display = 'block';
                renderKanban();
                updateAdminStats();
            } else {
                document.getElementById('studentDash').style.display = 'block';
                renderStudentTasks();
            }
        }

        function addTask() {
            const name = document.getElementById('taskName').value;
            const assignee = document.getElementById('assignee').value;
            const priority = document.getElementById('priority').value;
            const deadline = document.getElementById('deadline').value;
            const description = document.getElementById('description').value;
            const files = document.getElementById('fileUpload').files;

            if (name && assignee) {
                const task = {
                    id: Date.now(),
                    name,
                    assignee,
                    status: 'todo',
                    priority,
                    deadline,
                    description,
                    progress: 0,
                    files: [],
                    created: Date.now()
                };
                tasks.unshift(task);
                saveData();
                clearForm();
                renderKanban();
                if (currentUser !== assignee) {
                    addNotification(`${assignee}, new task assigned: ${name}`, assignee);
                }
                showNotification('‚úÖ Task created successfully!');
            }
        }

        function renderKanban() {
            const columns = {
                todo: document.getElementById('todo'),
                progress: document.getElementById('progress'),
                review: document.getElementById('review'),
                done: document.getElementById('done')
            };
            Object.values(columns).forEach(col => {
                col.innerHTML = `<h3>${col.id === 'todo' ? 'üìã To Do' : col.id === 'progress' ? '‚ö° In Progress' : col.id === 'review' ? 'üîç Review' : '‚úÖ Done'}</h3>`;
            });

            tasks.forEach(task => {
                const div = createTaskElement(task);
                columns[task.status].appendChild(div);
            });
        }

        function createTaskElement(task) {
            const div = document.createElement('div');
            div.className = `task ${task.priority}`;
            div.draggable = true;
            div.dataset.id = task.id;
            div.ondragstart = drag;
            
            const daysLeft = task.deadline ? Math.ceil((new Date(task.deadline) - Date.now()) / (1000 * 60 * 60 * 24)) : 0;
            const overdue = daysLeft < 0;
            
            div.innerHTML = `
                <strong>${task.name}</strong> 
                <div class="progress-bar"><div class="progress-fill" style="width: ${task.progress}%"></div></div>
                <small>${task.assignee} | ${task.priority.toUpperCase()} | ${overdue ? '‚è∞ OVERDUE' : daysLeft + ' days left'}</small>
                <p>${task.description || ''}</p>
                ${task.files.length > 0 ? `<small>üìé ${task.files.length} file(s)</small>` : ''}
                <div style="margin-top: 10px;">
                    ${currentUser === 'admin' ? `
                        <button onclick="deleteTask(${task.id})" class="danger" style="padding: 4px 8px; font-size: 12px;">üóëÔ∏è</button>
                    ` : ''}
                    ${currentUser === task.assignee ? `
                        <button onclick="updateProgress(${task.id})" style="padding: 4px 12px; font-size: 12px;">üìà ${task.progress}%</button>
                    ` : ''}
                </div>
            `;
            return div;
        }

        function renderStudentTasks() {
            const container = document.getElementById('studentTasks');
            container.innerHTML = '';
            const myTasks = tasks.filter(t => t.assignee === currentUser);
            myTasks.forEach(task => {
                const div = createTaskElement(task);
                div.draggable = true;
                div.dataset.id = task.id;
                div.ondragstart = drag;
                container.appendChild(div);
            });
        }

        // Drag & Drop
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.dataset.id); }
        function drop(ev) {
            ev.preventDefault();
            const taskId = parseInt(ev.dataTransfer.getData("text"));
            const task = tasks.find(t => t.id === taskId);
            const columnId = ev.currentTarget.id;
            task.status = columnId;
            saveData();
            renderKanban();
            showNotification(`‚úÖ Moved to ${columnId.toUpperCase()}`);
        }

        function updateProgress(id) {
            const task = tasks.find(t => t.id === id);
            task.progress = Math.min(task.progress + 25, 100);
            saveData();
            renderKanban();
            showNotification('üìà Progress updated!');
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveData();
            renderKanban();
            showNotification('üóëÔ∏è Task deleted');
        }

        function updateAdminStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.status === 'done').length;
            const overdue = tasks.filter(t => t.deadline && new Date(t.deadline) < Date.now()).length;
            document.getElementById('adminStats').innerHTML = `
                ${total} tasks | ${completed} done | ${overdue} overdue
            `;
        }

        function showReports() {
            const reportsContent = document.getElementById('reportsContent');
            const stats = {
                total: tasks.length,
                completed: tasks.filter(t => t.status === 'done').length,
                inProgress: tasks.filter(t => t.status === 'progress').length,
                overdue: tasks.filter(t => t.deadline && new Date(t.deadline) < Date.now()).length
            };
            
            reportsContent.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>${stats.total}</h3>
                        <p>Total Tasks</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.completed}</h3>
                        <p>Completed</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.inProgress}</h3>
                        <p>In Progress</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.overdue}</h3>
                        <p>Overdue</p>
                    </div>
                </div>
                <h3>Task Status Distribution</h3>
                <canvas id="statusChart" width="400" height="200"></canvas>
            `;
            document.getElementById('reportsModal').style.display = 'block';
            drawChart();
        }

        function drawChart() {
            // Simple canvas chart
            const canvas = document.getElementById('statusChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Basic bar chart logic here
        }

        function closeReports() {
            document.getElementById('reportsModal').style.display = 'none';
        }

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification show ${type}`;
            setTimeout(() => {
                notif.classList.remove('show');
            }, 4000);
        }

        function addNotification(message, user = null) {
            const notif = { id: Date.now(), message, user: user || currentUser, time: new Date().toLocaleString() };
            notifications.unshift(notif);
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }

        function checkNotifications() {
            const userNotifs = notifications.filter(n => !n.read && n.user === currentUser);
            userNotifs.forEach(n => {
                showNotification(n.message);
                n.read = true;
            });
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }

        function saveData() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function clearForm() {
            document.getElementById('taskName').value = '';
            document.getElementById('assignee').value = '';
            document.getElementById('description').value = '';
            document.getElementById('deadline').value = '';
        }

        function logout() {
            currentUser = '';
            document.querySelectorAll('.dashboard').forEach(d => d.style.display = 'none');
            document.getElementById('login').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Enter key login
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('login').style.display !== 'none') {
                login();
            }
        });
    </script>
</body>
</html>
